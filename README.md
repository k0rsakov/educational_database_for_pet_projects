# –î–µ–º–æ-–±–∞–∑—ã –¥–ª—è –æ–±—É—á–µ–Ω–∏—è PostgreSQL

–í —ç—Ç–æ–º [–≤–∏–¥–µ–æ](https://youtu.be/NFJbDist6Do) –≤—ã —É–∑–Ω–∞–µ—Ç–µ, –∫–∞–∫ –±—ã—Å—Ç—Ä–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –¥–µ–º–æ-–±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø—Ä–∞–∫—Ç–∏–∫–∏
SQL –∏ –æ–±—É—á–µ–Ω–∏—è —Ä–∞–±–æ—Ç–µ —Å PostgreSQL —Å –ø–æ–º–æ—â—å—é Docker.

–Ø –ø–æ–∫–∞–∂—É –ø–æ—à–∞–≥–æ–≤—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é, –∫–∞–∫ —Å–æ–∑–¥–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä PostgreSQL, –∑–∞–≥—Ä—É–∑–∏—Ç—å —à–∞–±–ª–æ–Ω–Ω—ã–µ –±–∞–∑—ã Chinook, Northwind,
Netflix –∏ PostgresPro Demo, –∞ —Ç–∞–∫–∂–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø–æ–ª–µ–∑–Ω—ã–µ SQL-–∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö. –í–∏–¥–µ–æ –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è
—Å—Ç—É–¥–µ–Ω—Ç–æ–≤, –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤, —Ç–µ—Ö, –∫—Ç–æ –≥–æ—Ç–æ–≤–∏—Ç pet-–ø—Ä–æ–µ–∫—Ç—ã –∏–ª–∏ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ, –ª–∏–±–æ –ø—Ä–æ—Å—Ç–æ —Ö–æ—á–µ—Ç –ø—Ä–æ–∫–∞—á–∞—Ç—å –Ω–∞–≤—ã–∫–∏
—Ä–∞–±–æ—Ç—ã —Å —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –±–∞–∑–∞–º–∏.

üíº –•–æ—á–µ—à—å —É—Å–∫–æ—Ä–∏—Ç—å —Ä–æ—Å—Ç –≤ –∫–∞—Ä—å–µ—Ä–µ? –Ø –ø—Ä–µ–¥–ª–∞–≥–∞—é –º–µ–Ω—Ç–æ—Ä—Å—Ç–≤–æ –ø–æ –¥–∞—Ç–∞-–∏–Ω–∂–µ–Ω–µ—Ä–∏–∏ –∏ IT-–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏:

- –ú–µ–Ω—Ç–æ—Ä—Å—Ç–≤–æ: https://korsak0v.notion.site/Data-Engineer-185c62fdf79345eb9da9928356884ea0
- –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏: https://korsak0v.notion.site/Data-Engineer-185c62fdf79345eb9da9928356884ea0

**–ß—Ç–æ –±—É–¥–µ—Ç –≤ —Ä–æ–ª–∏–∫–µ:**

- –ë—ã—Å—Ç—Ä–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ PostgreSQL —á–µ—Ä–µ–∑ Docker
- –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –∏–º–ø–æ—Ä—Ç —É—á–µ–±–Ω—ã—Ö –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö (Chinook, Northwind, Netflix, PostgresPro Demo)
- –ü—Ä–∏–º–µ—Ä—ã SQL-–∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- –ü–æ–ª–µ–∑–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã —Å –¥—Ä—É–≥–∏–º–∏ —à–∞–±–ª–æ–Ω–Ω—ã–º–∏ –±–∞–∑–∞–º–∏ –¥–ª—è –ø—Ä–∞–∫—Ç–∏–∫–∏

**–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ:**

- –£—á–µ–±–Ω—ã–µ –±–∞–∑—ã –Ω—É–∂–Ω—ã –¥–ª—è –æ—Ç—Ä–∞–±–æ—Ç–∫–∏ –Ω–∞–≤—ã–∫–æ–≤ SQL, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏—è–º
- –õ–æ–∫–∞–ª—å–Ω–∞—è –±–∞–∑–∞ ‚Äî —ç—Ç–æ –±—ã—Å—Ç—Ä–æ, –±–µ—Å–ø–ª–∞—Ç–Ω–æ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ –¥–ª—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤

üîî –ü–æ–¥–ø–∏—à–∏—Å—å –Ω–∞ –∫–∞–Ω–∞–ª, –µ—Å–ª–∏ —Ö–æ—á–µ—à—å —Ä–∞–∑–±–∏—Ä–∞—Ç—å—Å—è –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á–∞—Ö –¥–∞—Ç–∞-–∏–Ω–∂–µ–Ω–µ—Ä–æ–≤, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ –≤ —Ç–µ–æ—Ä–∏–∏.

–°—Å—ã–ª–∫–∏:

- –ú–µ–Ω—Ç–æ—Ä—Å—Ç–≤–æ/–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –ø–æ IT ‚Äì https://korsak0v.notion.site/Data-Engineer-185c62fdf79345eb9da9928356884ea0
- TG –∫–∞–Ω–∞–ª ‚Äì https://t.me/DataLikeQWERTY
- Instagram ‚Äì https://www.instagram.com/i__korsakov/
- Habr ‚Äì https://habr.com/ru/users/k0rsakov/publications/articles/
- Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏–∑ –≤–∏–¥–µ–æ ‚Äì https://github.com/k0rsakov/educational_database_for_pet_projects

## Init container

```bash
docker run -d --name my_postgres -e POSTGRES_USER=postgres -e POSTGRES_PASSWORD=postgres -e POSTGRES_DB=postgres -p 5432:5432 postgres:13
```

## Remove database

```bash
docker rm -f my_postgres
```

## Chinook Database

[Chinook Database](https://github.com/lerocha/chinook-database)

–ö–æ–ø–∏—Ä—É–µ–º –ª–æ–∫–∞–ª—å–Ω–æ:

```bash
curl -LfO https://github.com/lerocha/chinook-database/releases/download/v1.4.5/Chinook_PostgreSql.sql
```

–í—ã–ø–æ–ª–Ω—è–µ–º —Å–∫—Ä–∏–ø—Ç –≤ –Ω–∞—à–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ:

```bash
docker exec -i my_postgres psql -U postgres -d postgres < Chinook_PostgreSql.sql
```

–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:

```sql
SELECT a2.artist_id, name, count(*)
FROM album a 
JOIN artist a2 
ON a.artist_id = a2.artist_id
WHERE 1=1
GROUP BY 1,2
ORDER BY 3 DESC
```

## Netflix Sample Database

[Netflix Sample Database](https://github.com/lerocha/netflixdb)
–ö–æ–ø–∏—Ä—É–µ–º –ª–æ–∫–∞–ª—å–Ω–æ:

```bash
curl -LfO https://github.com/lerocha/netflixdb/releases/download/v1.0.11/netflixdb-postgres.zip && \
unzip netflixdb-postgres.zip && \
rm netflixdb-postgres.zip
```

–î–æ–±–∞–≤–ª—è–µ–º –ø–∞—Ä—É —Å—Ç—Ä–æ–∫ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ë–î –∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –Ω–∞ –Ω–µ—ë, —Ç–∞–∫ –∫–∞–∫ –≤ –∏—Å—Ö–æ–¥–Ω–æ–º —Å–∫—Ä–∏–ø—Ç–µ —Ç–∞–∫–æ–≥–æ –Ω–µ—Ç:

```bash
sed -i '' '1i\
DROP DATABASE IF EXISTS netflix;\
CREATE DATABASE netflix;\
\\c netflix;\
' netflixdb-postgres.sql
```

–í—ã–ø–æ–ª–Ω—è–µ–º —Å–∫—Ä–∏–ø—Ç –≤ –Ω–∞—à–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ:

```bash
docker exec -i my_postgres psql -U postgres -d postgres < netflixdb-postgres.sql
```

–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:

```sql
SELECT m.title, sum(views)
FROM view_summary v
JOIN movie m
	ON v.movie_id = m.id
WHERE 1=1
AND m.title  = 'Minions'
AND v.duration = 'WEEKLY'
GROUP BY 1
```

## Northwind database for Postgres

[Northwind database for Postgres](https://github.com/pthom/northwind_psql)
–ö–æ–ø–∏—Ä—É–µ–º –ª–æ–∫–∞–ª—å–Ω–æ:

```bash
curl -LfO https://raw.githubusercontent.com/pthom/northwind_psql/refs/heads/master/northwind.sql
```

–î–æ–±–∞–≤–ª—è–µ–º –ø–∞—Ä—É —Å—Ç—Ä–æ–∫ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ë–î –∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –Ω–∞ –Ω–µ—ë, —Ç–∞–∫ –∫–∞–∫ –≤ –∏—Å—Ö–æ–¥–Ω–æ–º —Å–∫—Ä–∏–ø—Ç–µ —Ç–∞–∫–æ–≥–æ –Ω–µ—Ç:

```bash
sed -i '' '1i\
DROP DATABASE IF EXISTS northwind;\
CREATE DATABASE northwind;\
\\c northwind;\
' northwind.sql
```

–í—ã–ø–æ–ª–Ω—è–µ–º —Å–∫—Ä–∏–ø—Ç –≤ –Ω–∞—à–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ:

```bash
docker exec -i my_postgres psql -U postgres -d postgres < northwind.sql
```

–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:

```sql
SELECT
	e.employee_id,
	e.first_name,
	e.last_name,
	sum(price_order) AS price_order,
	sum(price_order_with_discount) AS price_order_with_discount
FROM
	orders AS o
JOIN (
		SELECT
			order_id,
			sum(unit_price * quantity) AS price_order,
			sum(unit_price * quantity *(1-discount)) AS price_order_with_discount
		FROM
			order_details
		WHERE
			1 = 1
		GROUP BY
			1
	) AS od
	ON o.order_id = od.order_id
JOIN employees AS e
	ON o.employee_id = e.employee_id
WHERE
	1=1
	AND e.city = 'London'
	AND e.title = 'Sales Representative'
GROUP BY
	1,
	2,
	3
```

## PostgresPro Demonstration Database

[PostgresPro Demonstration Database](https://postgrespro.com/community/demodb)
–ö–æ–ø–∏—Ä—É–µ–º –ª–æ–∫–∞–ª—å–Ω–æ:

```bash
curl -LfO https://edu.postgrespro.com/demo-small-en.zip && \
unzip demo-small-en.zip && \
rm demo-small-en.zip
```

–í—ã–ø–æ–ª–Ω—è–µ–º —Å–∫—Ä–∏–ø—Ç –≤ –Ω–∞—à–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ:

```bash
docker exec -i my_postgres psql -U postgres -d postgres < demo-small-en-20170815.sql
```

–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:

```sql
SELECT
	departure_airport,
	count(f.arrival_airport) AS all_flights,
	count(DISTINCT arrival_airport) AS all_flights_distinct_airport
FROM flights f 	
WHERE 1=1
AND status = 'Arrived'
GROUP BY 1
ORDER BY 2 DESC
```

–ö—É—Ä—Å –ø–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
–∑–∞–ø—Ä–æ—Å–æ–≤ ‚Äì [PostgreSQL 13. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤](https://www.youtube.com/playlist?list=PLaFqU3KCWw6JW80WBHPOe-SMJD2NOjmge) .

## –î—Ä—É–≥–∏–µ –ø—Ä–∏–º–µ—Ä—ã –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö

- https://github.com/oracle-samples/db-sample-schemas/tree/main
- https://github.com/microsoft/sql-server-samples
- https://github.com/datacharmer/test_db

[YouTube –≤–∏–¥–µ–æ —Å –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–µ–π –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–±—É—á–µ–Ω–∏—è PostgreSQL](https://youtu.be/NFJbDist6Do)